<!DOCTYPE html>
<html>
<head>
    <title>OSRM Routing with OpenStreetMap</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map { height: 500px; width: 100%; }
    </style>
</head>
<body>
    <h1>Routing with OSRM</h1>

    <label for="start">Start Location:</label>
    <input type="text" id="start" placeholder="Current Location (auto-detected)">

    <label for="end">End Location:</label>
    <input type="text" id="end" placeholder="Destination">
    <a href="{% url 'choice' %}"><button onclick="storeValues();">Calculate</button></a>


    <div id="map"></div>
    <div id="instructions"></div>

    <script>

      var map = L.map('map').setView([0, 0], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      var startMarker, endMarker, routeLayer;

      function getLocation() {
          return new Promise((resolve, reject) => {
              if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(position => {
                      resolve([position.coords.latitude, position.coords.longitude]);
                  }, error => {
                      reject(error);
                  });
              } else {
                  reject("Geolocation is not supported by this browser.");
              }
          });
      }

      function storeValues() {
        var startInput = document.getElementById('start').value;
        var endInput = document.getElementById('end').value;
        console.log(startInput)
        console.log(endInput)
        localStorage["startInput"] = startInput;
        localStorage["endInput"] = endInput;
      }

      async function geocode(address) {
          const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json`;
          try {
              const response = await fetch(url);
              const data = await response.json();
              if (data && data.length > 0) {
                  return [parseFloat(data[0].lat), parseFloat(data[0].lon)];
              } else {
                  return null;
              }
          } catch (error) {
              console.error("Geocoding error:", error);
              return null;
          }
      }

    </script>
</body>
</html>
